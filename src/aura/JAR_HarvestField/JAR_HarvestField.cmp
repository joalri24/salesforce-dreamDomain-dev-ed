<aura:component implements="flexipage:availableForAllPageTypes" access="global" >
    
    <!-- ************** Attributes ************** -->
    <aura:attribute name="recordId" type="Id" default="a031U000001JHCFQA4"/>
    <aura:attribute name="harvestField" type="Harvest_Field__c"/>
    <aura:attribute name="height" type="String" default="700px" access="global"/>
    <aura:attribute name="irrigationColumns" type="List"/>
    <aura:attribute name="irrigationHistory" type="Object[]" default="[]"/>
    <aura:attribute name="harvestColumns" type="List"/>
    <aura:attribute name="harvests" type="Object[]" default="[]"/>


    <!-- ************** Handlers ************** -->
    <aura:handler name="init" value="{!this}" action="{!c.onInit}" />
    <aura:handler event="ltng:selectSObject" action="{!c.recordChangeHandler}" />

    <!-- ************** Data Service ************** -->

    <force:recordData aura:id="service"
        recordId="{!v.recordId}"
        targetFields="{!v.harvestField}"
        mode="EDIT"
        fields="['Id', 'Name', 'Crop__c', 'Size__c', 'Status__c', 'Yield__c', 'Map_Id__c', 'Irrigation__c', 'Picture_URL__c']"
        recordUpdated="{!c.recordUpdatedHandler}"/> 


    <!-- ************** Body ************** -->  
    <div style="{! 'height: ' + v.height}">
        <aura:if isTrue="{! v.recordId}">

            <lightning:card>
        
                <aura:set attribute="title">
                    <lightning:icon iconName="custom:custom5" /> {!v.harvestField.Name}
                </aura:set>
         
                <aura:set attribute="actions">
                    <lightning:button label="Details" onclick="{!c.navigateToRecordHome}"/>
                </aura:set>

                <aura:if isTrue="{! true}">
                        <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
                        <h2>ALERT: Irrigation level below threshold</h2>
                    </div>
                </aura:if>

                <aura:if isTrue="{! true}">
                        <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_warning" role="alert">
                        <h2>ALERT: Irrigation level below threshold</h2>
                    </div>
                </aura:if>

                <lightning:layout class="details">
                    
                    <lightning:layoutItem>
                        <img src="{!v.harvestField.Picture_URL__c}" class="crop"/>    
                    </lightning:layoutItem>

                    <lightning:layoutItem>
                        <div class="form details">
                            <div> <label>Crop:</label>{!v.harvestField.Crop__c} </div>
                            <div> <label>Size:</label>{!v.harvestField.Size__c} </div>
                            <div> <label>Yield:</label>{!v.harvestField.Yield__c} lbs </div>
                        </div>                         
                    </lightning:layoutItem>

                </lightning:layout> 

                <lightning:accordion>

                    <lightning:accordionSection label="Irrigation">
                        
                        <lightning:layout>

                            <lightning:layoutItem flexibility="grow">
                                <div class="form">
                                    <div><label>Level:</label>19.8%</div>
                                    <div><label>Status:</label>{!v.harvestField.Status__c}</div>
                                </div>
                            </lightning:layoutItem>

                            <lightning:layoutItem>
                                <lightning:input class="irrigation-toggle" type="toggle" label="Irrigation" name="IrrigationToggle" checked="{!v.harvestField.Irrigation__c}" onchange="{!c.toggleChangeHandler}" />
                            </lightning:layoutItem> 

                        </lightning:layout>

                        <lightning:datatable data="{!v.irrigationHistory}" columns="{!v.irrigationColumns}" keyField="id"/>
                        
                    </lightning:accordionSection>
                    
                    <lightning:accordionSection label="Harvest"> 
                        <lightning:datatable data="{!v.harvests}" columns="{!v.harvestColumns}" keyField="id"/>
                    </lightning:accordionSection>

                    <lightning:accordionSection label="More info">                        
                    </lightning:accordionSection>

                </lightning:accordion>
                <img src="{!$Resource.purealoe + '/ground_' + v.harvestField.Status__c + '.png'}" class="ground" alt="status image" />
  
            </lightning:card>
            
        </aura:if>
    </div>

</aura:component>